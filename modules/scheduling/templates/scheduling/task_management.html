{% extends 'base.html' %}

{% block title %}
ä»»åŠ¡ç®¡ç† - å®‰å¾½XXæ™ºèƒ½è¿åŠ›ç³»ç»Ÿ
{% endblock %}

{% block extra_css %}
    {{ super() }}
    <!-- Font Awesomeå›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- ä½¿ç”¨å¤–éƒ¨CSSæ–‡ä»¶æ›¿ä»£å†…è”æ ·å¼ -->
    <link rel="stylesheet" href="../../../../static/feishu-styles.css">
    <style>
        /* ä»…ä¿ç•™æ— æ³•åœ¨é€šç”¨CSSä¸­å®šä¹‰çš„ç‰¹å®šæ ·å¼ */
        .task-management-container {
            height: calc(100vh - 120px);
        }
        
        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: var(--feishu-spacing-md);
        }
        
        .progress-step.completed {
            background: rgba(0, 214, 185, 0.1);
        }
        
        .progress-step.active {
            background: rgba(51, 112, 255, 0.1);
            border: 1px solid rgba(51, 112, 255, 0.2);
        }
        
        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        
        .step-icon.completed {
            background: var(--feishu-success);
        }
        
        .step-icon.active {
            background: var(--feishu-primary);
        }
        
        .step-icon.pending {
            background: var(--feishu-text-tertiary);
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--feishu-text-primary);
            margin: 0;
        }
        
        .step-subtitle {
            font-size: 12px;
            color: var(--feishu-text-secondary);
            margin: 0;
        }
        
        /* é£ä¹¦é£æ ¼æ—¶é—´çº¿ */
        .feishu-timeline {
            padding: var(--feishu-spacing-md);
        }
        
        .timeline-item {
            display: flex;
            gap: var(--feishu-spacing-sm);
            padding: var(--feishu-spacing-sm) 0;
            border-left: 2px solid var(--feishu-border);
            padding-left: var(--feishu-spacing-lg);
            margin-left: 8px;
        }
        
        .timeline-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--feishu-primary);
            margin-left: -20px;
            margin-top: 6px;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--feishu-text-primary);
            margin: 0;
        }
        
        .timeline-subtitle {
            font-size: 12px;
            color: var(--feishu-text-secondary);
            margin: 0;
        }
        
        .timeline-desc {
            font-size: 13px;
            color: var(--feishu-text-secondary);
            margin-top: 4px;
        }
        
        /* é£ä¹¦é£æ ¼åˆ†é¡µ */
        .feishu-pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--feishu-spacing-sm);
            padding: var(--feishu-spacing-md);
            flex-wrap: wrap;
        }
        
        .feishu-page-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            border: 1px solid var(--feishu-border);
            border-radius: var(--feishu-radius);
            background: var(--feishu-white);
            color: var(--feishu-text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .feishu-page-btn:hover:not(.feishu-page-btn-disabled) {
            border-color: var(--feishu-primary);
            color: var(--feishu-primary);
        }
        
        .feishu-page-btn-disabled {
            color: var(--feishu-text-tertiary);
            cursor: not-allowed;
            background: var(--feishu-bg);
        }
        
        .feishu-page-numbers {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .feishu-page-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: 1px solid var(--feishu-border);
            border-radius: var(--feishu-radius);
            background: var(--feishu-white);
            color: var(--feishu-text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .feishu-page-number:hover {
            border-color: var(--feishu-primary);
            color: var(--feishu-primary);
        }
        
        .feishu-page-number-active {
            background: var(--feishu-primary);
            color: white;
            border-color: var(--feishu-primary);
        }
        
        .feishu-page-ellipsis {
            color: var(--feishu-text-tertiary);
            font-size: 14px;
            margin: 0 4px;
        }
        
        .feishu-page-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
            margin-left: auto;
        }
        
        .feishu-page-info span {
            font-size: 12px;
            color: var(--feishu-text-secondary);
        }
    </style>
{% endblock %}

{% block content %}
<div class="container-fluid h-100" style="padding-top: var(--feishu-spacing-md);">
    <div class="row h-100">
        <!-- å·¦ä¾§åŒºåŸŸï¼šç­›é€‰æ¡ä»¶ + è¿è¾“åˆ—è¡¨ï¼ˆå 2/3ï¼‰ -->
        <div class="col-lg-8 col-md-12 h-100 d-flex flex-column">
            <!-- ç­›é€‰æ¡ä»¶åŒºåŸŸ - 3Ã—3ç½‘æ ¼å¸ƒå±€ -->
            <div class="feishu-card mb-3">
                <div class="filter-header">
                    <h5><i class="fas fa-filter"></i> ç­›é€‰æ¡ä»¶</h5>
                    <div>
                        <a href="{{ url_for('scheduling_bp.index') }}" class="feishu-btn feishu-btn-secondary feishu-btn-sm">
                            <i class="fas fa-arrow-left"></i> è¿”å›ä¸»é¡µ
                        </a>
                        <button class="feishu-btn feishu-btn-secondary feishu-btn-sm ms-2" id="toggleFilters">
                            <i class="fas fa-eye"></i> æ˜¾ç¤ºç­›é€‰æ¡ä»¶
                        </button>
                        <button class="feishu-btn feishu-btn-secondary feishu-btn-sm">é‡ç½®</button>
                    </div>
                </div>
                <div class="filter-body" id="filterBody" style="display: none;">
                    <div class="row g-3">
                        <!-- ç¬¬ä¸€è¡Œï¼šå‘èµ·å•ä½ã€è½¨é“ç±»å‹ã€ä»»åŠ¡çŠ¶æ€ -->
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">å‘èµ·å•ä½</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨å•ä½</option>
                                    <option>åŒ—äº¬å±€</option>
                                    <option>ä¸Šæµ·å±€</option>
                                    <option>å¹¿å·å±€</option>
                                    <option>æˆéƒ½å±€</option>
                                    <option>æ­¦æ±‰å±€</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">è½¨é“ç±»å‹</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨ç±»å‹</option>
                                    <option>åœ°è°ƒæ´¾è½¦</option>
                                    <option>è°ƒåº¦ç›´æ´¾</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">ä»»åŠ¡çŠ¶æ€</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨çŠ¶æ€</option>
                                    <option>å¾…å¤„ç†</option>
                                    <option>è¿›è¡Œä¸­</option>
                                    <option>å·²å®Œæˆ</option>
                                    <option>å·²å–æ¶ˆ</option>
                                    <option>å·²æš‚åœ</option>
                                </select>
                            </div>
                        </div>
                        <!-- ç¬¬äºŒè¡Œï¼šå§‹å‘å±€ã€é‚®è·¯ã€æ—¶é—´èŒƒå›´ -->
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">å§‹å‘å±€</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨å§‹å‘å±€</option>
                                    <option>åŒ—äº¬</option>
                                    <option>ä¸Šæµ·</option>
                                    <option>å¹¿å·</option>
                                    <option>æ·±åœ³</option>
                                    <option>æˆéƒ½</option>
                                    <option>æ­¦æ±‰</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">é‚®è·¯</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨é‚®è·¯</option>
                                    <option>äº¬å¹¿çº¿</option>
                                    <option>äº¬æ²ªçº¿</option>
                                    <option>æ²ªæ˜†çº¿</option>
                                    <option>é™‡æµ·çº¿</option>
                                    <option>äº¬ä¹çº¿</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">æ—¶é—´èŒƒå›´</label>
                                <input type="date" class="feishu-input" value="2024-01-15">
                            </div>
                        </div>
                        <!-- ç¬¬ä¸‰è¡Œï¼šä¼˜å…ˆçº§ã€æ‰¿è¿å•†ã€æŸ¥è¯¢æŒ‰é’® -->
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">ä¼˜å…ˆçº§</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨ä¼˜å…ˆçº§</option>
                                    <option>ç´§æ€¥</option>
                                    <option>é«˜</option>
                                    <option>ä¸­</option>
                                    <option>ä½</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">æ‰¿è¿å•†</label>
                                <select class="feishu-select">
                                    <option>å…¨éƒ¨æ‰¿è¿å•†</option>
                                    <option>ä¸­å›½é‚®æ”¿</option>
                                    <option>é¡ºä¸°é€Ÿè¿</option>
                                    <option>ä¸­é€šå¿«é€’</option>
                                    <option>åœ†é€šé€Ÿé€’</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6">
                            <div class="filter-group mb-0">
                                <label class="filter-label">&nbsp;</label>
                                <button class="feishu-btn feishu-btn-primary w-100">
                                    <i class="fas fa-search"></i> æŸ¥è¯¢
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    document.getElementById('toggleFilters').addEventListener('click', function() {
                        const filterBody = document.getElementById('filterBody');
                        const button = document.getElementById('toggleFilters');
                        
                        if (filterBody.style.display === 'none') {
                            filterBody.style.display = 'block';
                            button.innerHTML = '<i class="fas fa-eye-slash"></i> éšè—ç­›é€‰æ¡ä»¶';
                        } else {
                            filterBody.style.display = 'none';
                            button.innerHTML = '<i class="fas fa-eye"></i> æ˜¾ç¤ºç­›é€‰æ¡ä»¶';
                        }
                    });
                </script>
                
                <!-- ä¸»å†…å®¹åŒºåŸŸ - å·¦å³åˆ†å¸ƒ -->
                <div class="main-content-wrapper">
                    <!-- å·¦ä¾§è¿è¾“ä»»åŠ¡åˆ—è¡¨ï¼ˆå 2/3ï¼‰ -->
                    <div class="task-list-section">
                        <div class="feishu-card flex-fill">
                            <div class="list-panel">
                                <div class="list-header">
                                    <h5 class="list-title">è¿è¾“ä»»åŠ¡åˆ—è¡¨</h5>
                                    <p class="list-subtitle">å…± <span id="totalCount">0</span> æ¡è®°å½•</p>
                                </div>
                                
                                <div class="table-container" style="overflow-x: auto;">
                                    <table class="feishu-table">
                                        <!-- ä¿®å¤åçš„è¡¨æ ¼è¡¨å¤´ -->
                                        <thead>
                                            <tr>
                                                <th style="width: 50px;">åºå·</th>
                                                <th style="width: 120px;">ä»»åŠ¡ç¼–å·</th>
                                                <th style="width: 100px;">å§‹å‘å±€</th>
                                                <th style="width: 120px;">çº¿è·¯åç§°</th>
                                                <th style="width: 100px;">è¿è¾“ç±»å‹</th>
                                                <th style="width: 120px;">æ‰¿è¿å•†</th>
                                                <th style="width: 100px;">çŠ¶æ€</th>
                                                <th style="width: 80px;">ä¼˜å…ˆçº§</th>
                                                <th style="width: 120px;">è¦æ±‚æ—¶é—´</th>
                                                <th style="width: 80px;">æ“ä½œ</th>
                                            </tr>
                                        </thead>
                                        <tbody id="taskListBody">
                                            <!-- åŠ¨æ€åŠ è½½æ•°æ® -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="list-header" style="border-top:1px solid var(--feishu-border);">
                                    <nav aria-label="Page navigation">
                                        <div class="feishu-pagination" id="paginationContainer">
                                            <!-- åŠ¨æ€ç”Ÿæˆåˆ†é¡µ -->
                                        </div>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å³ä¾§æµç¨‹è¯¦æƒ…ï¼ˆå 1/3ï¼‰ -->
                    <div class="detail-section">
                        <div class="detail-panel">
                            <div class="detail-header">
                                <h5><i class="fas fa-file-alt"></i> æµç¨‹è¯¦æƒ…</h5>
                                <button class="feishu-btn feishu-btn-secondary feishu-btn-sm">å…³é—­</button>
                            </div>
                            
                            <!-- æµç¨‹è¿›åº¦ -->
                            <div class="detail-section" style="padding:12px 16px;border-bottom:1px solid var(--feishu-border);">
                                <h6 style="color:var(--feishu-text-secondary);margin-bottom:12px;font-size:14px;">æµç¨‹è¿›åº¦</h6>
                                <div class="progress-steps" style="gap:8px;">
                                    <div class="progress-step completed" style="padding:8px;">
                                        <div class="step-icon completed" style="width:20px;height:20px;font-size:10px;">1</div>
                                        <div class="step-content">
                                            <p class="step-title" style="font-size:13px;">åŒºåŸŸè°ƒåº¦æ´¾è½¦</p>
                                            <p class="step-subtitle" style="font-size:11px;">å¼ ç»ç† 08:30</p>
                                        </div>
                                    </div>
                                    <div class="progress-step active" style="padding:8px;">
                                        <div class="step-icon active" style="width:20px;height:20px;font-size:10px;">2</div>
                                        <div class="step-content">
                                            <p class="step-title" style="font-size:13px;">æ‰¿è¿å•†å“åº”</p>
                                            <p class="step-subtitle" style="font-size:11px;">å¾…å¤„ç†</p>
                                        </div>
                                    </div>
                                    <div class="progress-step" style="padding:8px;">
                                        <div class="step-icon pending" style="width:20px;height:20px;font-size:10px;">3</div>
                                        <div class="step-content">
                                            <p class="step-title" style="font-size:13px;">è½¦é—´å‘è½¦</p>
                                            <p class="step-subtitle" style="font-size:11px;">å¾…å¤„ç†</p>
                                        </div>
                                    </div>
                                    <div class="progress-step" style="padding:8px;">
                                        <div class="step-icon pending" style="width:20px;height:20px;font-size:10px;">4</div>
                                        <div class="step-content">
                                            <p class="step-title" style="font-size:13px;">æ‰¿è¿å•†ç¡®è®¤</p>
                                            <p class="step-subtitle" style="font-size:11px;">å¾…å¤„ç†</p>
                                        </div>
                                    </div>
                                    <div class="progress-step" style="padding:8px;">
                                        <div class="step-icon pending" style="width:20px;height:20px;font-size:10px;">5</div>
                                        <div class="step-content">
                                            <p class="step-title" style="font-size:13px;">è½¦é—´æœ€ç»ˆç¡®è®¤</p>
                                            <p class="step-subtitle" style="font-size:11px;">å¾…å¤„ç†</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- åŸºç¡€ä¿¡æ¯ -->
                            <div class="detail-section" style="padding:12px 16px;border-bottom:1px solid var(--feishu-border);">
                                <h6 style="color:var(--feishu-text-secondary);margin-bottom:12px;font-size:14px;">åŸºç¡€ä¿¡æ¯</h6>
                                <div style="font-size:13px;line-height:1.6;">
                                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="color:var(--feishu-text-secondary);">æµç¨‹ç¼–å·</span><span style="font-weight:500;">LC2308001</span></div>
                                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="color:var(--feishu-text-secondary);">è½¨é“ç±»å‹</span><span style="font-weight:500;">è½¨é“B</span></div>
                                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="color:var(--feishu-text-secondary);">å‘èµ·è½¦é—´</span><span style="font-weight:500;">åˆè‚¥ä¸­å¿ƒå±€</span></div>
                                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="color:var(--feishu-text-secondary);">æ‰¿è¿å•†</span><span style="font-weight:500;">ä¸­å›½é‚®æ”¿é€Ÿé€’ç‰©æµ</span></div>
                                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="color:var(--feishu-text-secondary);">è´§ç‰©ä¿¡æ¯</span><span style="font-weight:500;">5å¨/35ç«‹æ–¹ç±³</span></div>
                                    <div style="display:flex;justify-content:space-between;"><span style="color:var(--feishu-text-secondary);">å‘èµ·æ—¶é—´</span><span style="font-weight:500;">2023-08-01 08:30</span></div>
                                </div>
                            </div>
                            
                            <!-- æ“ä½œè®°å½• -->
                            <div class="detail-section" style="padding:12px 16px;border-bottom:1px solid var(--feishu-border);">
                                <h6 style="color:var(--feishu-text-secondary);margin-bottom:12px;font-size:14px;">æ“ä½œè®°å½•</h6>
                                <div class="feishu-timeline" style="padding:0;">
                                    <div class="timeline-item" style="padding:8px 0;">
                                        <div class="timeline-dot" style="width:6px;height:6px;margin-left:-15px;"></div>
                                        <div class="timeline-content">
                                            <p class="timeline-title" style="font-size:13px;margin:0;">åŒºåŸŸè°ƒåº¦æ´¾è½¦</p>
                                            <p class="timeline-subtitle" style="font-size:11px;margin:0;">å¼ ç»ç† 08:30</p>
                                            <p class="timeline-desc" style="font-size:12px;margin-top:2px;">æ´¾è½¦è‡³åˆè‚¥ä¸­å¿ƒå±€ï¼Œ5å¨è½¦è¾†</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å½“å‰æ“ä½œ -->
                            <div class="detail-section" style="padding:12px 16px;">
                                <h6 style="color:var(--feishu-text-secondary);margin-bottom:12px;font-size:14px;">å½“å‰æ“ä½œ</h6>
                                <div style="display:flex;gap:8px;flex-direction:column;">
                                    <button class="feishu-btn feishu-btn-primary" style="padding:8px 12px;font-size:13px;">
                                        <i class="fas fa-check"></i> ç¡®è®¤å“åº”
                                    </button>
                                    <button class="feishu-btn feishu-btn-secondary" style="padding:8px 12px;font-size:13px;">
                                        <i class="fas fa-comment"></i> æ·»åŠ å¤‡æ³¨
                                    </button>
                                    <button class="feishu-btn feishu-btn-warning" style="padding:8px 12px;font-size:13px;">
                                        <i class="fas fa-exclamation-triangle"></i> ç”³è¯·æš‚åœ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- ç»å¯¹å¯è§çš„è°ƒè¯•é¢æ¿ -->
<div id="debugPanel" style="position: fixed !important; top: 10px !important; right: 10px !important; width: 350px !important; max-height: 300px !important; background: rgba(255, 0, 0, 0.9) !important; color: white !important; border: 3px solid yellow !important; border-radius: 8px !important; font-size: 12px !important; font-family: monospace !important; overflow-y: auto !important; z-index: 99999 !important; padding: 10px !important; box-shadow: 0 0 15px rgba(255, 0, 0, 0.5) !important;">
    <div style="font-weight: bold; border-bottom: 1px solid white; margin-bottom: 5px;">
        ğŸ” å¼ºåˆ¶è°ƒè¯•é¢æ¿ (ç»å¯¹å¯è§)
        <button onclick="document.getElementById('debugPanel').style.display='none'" style="float: right; background: white; color: red; border: none; padding: 2px 6px; cursor: pointer; border-radius: 3px; font-size: 10px;">âœ•</button>
    </div>
    <div id="debugContent"></div>
</div>


    
    <!-- ES6æ¨¡å—å¯¼å…¥ -->
    <script type="module">
        import { initTaskManagement } from '../../../../static/modules/index.js';
        
        // åˆå§‹åŒ–ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await initTaskManagement({
                    taskManager: {
                        apiEndpoint: '/api/dispatch/tasks',
                        pageSize: 10,
                        debug: true
                    },
                    taskRenderer: {
                        containerId: 'taskListBody',
                        emptyStateId: 'emptyState',
                        loadingId: 'loadingState'
                    },
                    pagination: {
                        containerId: 'paginationContainer',
                        maxPages: 5
                    }
                });
                
                console.log('ä»»åŠ¡ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('ä»»åŠ¡ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                alert('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        });
    </script>
{% endblock %}