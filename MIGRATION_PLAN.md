# æ•°æ®åº“æ¶æ„è¿ç§»è®¡åˆ’

## å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆ**: DatabaseManager åˆ° DatabaseManagerCompat çš„å…¼å®¹å±‚è¿ç§»
- æ‰€æœ‰æ–‡ä»¶ä¸­çš„ DatabaseManager å¼•ç”¨å·²æ›¿æ¢ä¸ºå…¼å®¹å±‚
- åº”ç”¨å¯åŠ¨æ­£å¸¸ï¼Œæ•°æ®åº“åˆå§‹åŒ–æ­£å¸¸
- è¿ç§»æµ‹è¯•å…¨éƒ¨é€šè¿‡

## ç¬¬ä¸€é˜¶æ®µï¼šç³»ç»Ÿç¨³å®šæ€§ç›‘æ§ (1-2å‘¨)

### ç›®æ ‡
ç›‘æ§è¿ç§»åçš„ç³»ç»Ÿç¨³å®šæ€§ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒæ­£å¸¸è¿è¡Œ

### å®æ–½æ­¥éª¤

1. **éƒ¨ç½²ç›‘æ§è„šæœ¬**
   ```bash
   python scripts/monitor_stability.py
   ```

2. **ç›‘æ§æŒ‡æ ‡**
   - æ•°æ®åº“è¿æ¥æˆåŠŸç‡
   - æŸ¥è¯¢æ‰§è¡Œæ—¶é—´
   - é”™è¯¯ç‡ç»Ÿè®¡
   - å“åº”æ—¶é—´åˆ†å¸ƒ

3. **å‘Šè­¦é˜ˆå€¼**
   - é”™è¯¯ç‡ > 5% â†’ è­¦å‘Š
   - å¹³å‡å“åº”æ—¶é—´ > 100ms â†’ è­¦å‘Š
   - æœ€å¤§å“åº”æ—¶é—´ > 1s â†’ ä¸¥é‡è­¦å‘Š

## ç¬¬äºŒé˜¶æ®µï¼šä¸šåŠ¡é€»è¾‘è¿ç§»åˆ° Services æ¶æ„ (2-4å‘¨)

### è¿ç§»ä¼˜å…ˆçº§

#### é«˜ä¼˜å…ˆçº§ (ç¬¬1å‘¨)
1. **ç”¨æˆ·ç®¡ç†æ¨¡å—** (`modules/user_management/`)
   - è¿ç§»ç”¨æˆ·æŸ¥è¯¢ã€æƒé™éªŒè¯é€»è¾‘
   - ä½¿ç”¨ DatabaseService.get_db_manager() ä¸Šä¸‹æ–‡ç®¡ç†å™¨

2. **æ´¾è½¦ä»»åŠ¡æ¨¡å—** (`api/dispatch.py`)
   - è¿ç§»ä»»åŠ¡åˆ›å»ºã€çŠ¶æ€æ›´æ–°é€»è¾‘
   - å®ç°äº‹åŠ¡æ€§æ“ä½œ

#### ä¸­ä¼˜å…ˆçº§ (ç¬¬2å‘¨)
3. **å®¡æ ¸æ¨¡å—** (`api/audit.py`)
   - è¿ç§»å®¡æ ¸æµç¨‹é€»è¾‘
   - å®ç°å®¡æ ¸çŠ¶æ€è·Ÿè¸ª

4. **ç³»ç»Ÿæ¨¡å—** (`modules/system/`)
   - è¿ç§»æ¨¡å—æƒé™ç®¡ç†
   - ä½¿ç”¨æ–°çš„æ•°æ®åº“æœåŠ¡æ¥å£

#### ä½ä¼˜å…ˆçº§ (ç¬¬3-4å‘¨)
5. **å…¶ä»–ä¸šåŠ¡æ¨¡å—**
   - æˆæœ¬åˆ†æã€è§„åˆ’ã€å¯¹è´¦ç­‰æ¨¡å—
   - é€æ­¥è¿ç§»å‰©ä½™ä¸šåŠ¡é€»è¾‘

### è¿ç§»æ¨¡å¼

```python
# æ—§æ¨¡å¼ (é€æ­¥æ·˜æ±°)
from services.db_manager_compat import DatabaseManagerCompat as DatabaseManager
db = DatabaseManager()
db.connect()
try:
    # ä¸šåŠ¡é€»è¾‘
    result = db.execute_query("SELECT ...")
finally:
    db.disconnect()

# æ–°æ¨¡å¼ (æ¨è)
from services.database_service import DatabaseService

with DatabaseService.get_db_manager() as db:
    # ä¸šåŠ¡é€»è¾‘ - è‡ªåŠ¨ç®¡ç†è¿æ¥
    result = db.execute_query("SELECT ...")

# æˆ–è€…ä½¿ç”¨äº‹åŠ¡
with DatabaseService.transaction() as conn:
    cursor = conn.cursor()
    cursor.execute("INSERT ...")
```

## ç¬¬ä¸‰é˜¶æ®µï¼šç§»é™¤å…¼å®¹å±‚ (1å‘¨)

### è¿ç§»å®Œæˆæ ‡å‡†
- æ‰€æœ‰ä¸šåŠ¡æ¨¡å—å·²ä½¿ç”¨ DatabaseService
- æ— ç›´æ¥ä½¿ç”¨ DatabaseManagerCompat çš„ä»£ç 
- ç¨³å®šæ€§ç›‘æ§æ˜¾ç¤ºæ­£å¸¸

### ç§»é™¤æ­¥éª¤

1. **åˆ é™¤å…¼å®¹å±‚å¯¼å…¥**
   ```python
   # åˆ é™¤è¿™è¡Œ
   from services.db_manager_compat import DatabaseManagerCompat as DatabaseManager
   ```

2. **æ›´æ–°æ•°æ®åº“æœåŠ¡**
   ```python
   # åœ¨ database_service.py ä¸­
   from services.db_connection_manager import DBConnectionManager
   from services.db_table_manager import DBTableManager
   from services.db_data_manager import DBDataManager
   
   # ç›´æ¥ä½¿ç”¨æ–°çš„æœåŠ¡ç»„ä»¶
   ```

3. **æ¸…ç†å…¼å®¹å±‚æ–‡ä»¶**
   - åˆ é™¤ `services/db_manager_compat.py`
   - æ›´æ–°ç›¸å…³æµ‹è¯•ç”¨ä¾‹

## é£é™©æ§åˆ¶

### å›æ»šæ–¹æ¡ˆ
1. ä¿æŒ git ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾¿äºå›é€€
2. åˆ†é˜¶æ®µéƒ¨ç½²ï¼Œæ¯ä¸ªæ¨¡å—è¿ç§»åå•ç‹¬æµ‹è¯•
3. ç”Ÿäº§ç¯å¢ƒå…ˆéƒ¨ç½²ç›‘æ§ï¼Œå†æ‰§è¡Œè¿ç§»

### ç›‘æ§é‡ç‚¹
1. æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
2. äº‹åŠ¡å¤„ç†æ­£ç¡®æ€§
3. æ€§èƒ½æŒ‡æ ‡å˜åŒ–
4. é”™è¯¯æ—¥å¿—åˆ†æ

## æ—¶é—´å®‰æ’

| é˜¶æ®µ | æ—¶é—´ | çŠ¶æ€ |
|------|------|------|
| ç¨³å®šæ€§ç›‘æ§ | ç¬¬1-2å‘¨ | ğŸŸ¡ è¿›è¡Œä¸­ |
| ä¸šåŠ¡é€»è¾‘è¿ç§» | ç¬¬3-6å‘¨ | âšª æœªå¼€å§‹ |
| å…¼å®¹å±‚ç§»é™¤ | ç¬¬7å‘¨ | âšª æœªå¼€å§‹ |

## è´£ä»»åˆ†å·¥

- **å¼€å‘å›¢é˜Ÿ**: å®æ–½ä»£ç è¿ç§»ï¼Œç¼–å†™æµ‹è¯•ç”¨ä¾‹
- **æµ‹è¯•å›¢é˜Ÿ**: éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§ï¼Œæ€§èƒ½æµ‹è¯•
- **è¿ç»´å›¢é˜Ÿ**: éƒ¨ç½²ç›‘æ§ï¼Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## æˆåŠŸæ ‡å‡†

1. âœ… é›¶å®•æœºè¿ç§»
2. âœ… æ€§èƒ½æŒ‡æ ‡ä¸ä¸‹é™
3. âœ… åŠŸèƒ½å®Œæ•´æ€§ä¿æŒ
4. âœ… ä»£ç å¯ç»´æŠ¤æ€§æå‡
5. âœ… ç³»ç»Ÿç¨³å®šæ€§æé«˜

---

*æœ€åæ›´æ–°: {update_date}*